<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LightsAwait Chatbot</title>
  <style>
    body {
      margin: 0;
      padding-top: 20px;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #3e365b;
      font-family: Arial, sans-serif;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 10px 0;
      display: flex;
      justify-content: center;
      gap: 20px;
      z-index: 999;
    }

    nav a {
      color: #ddd;
      text-decoration: none;
      font-weight: bold;
    }

    nav a:hover {
      color: #fff;
      text-decoration: underline;
    }

    #phone {
      position: relative;
      width: 80vw;
      height: calc(135vh - 30px);
      max-width: 393px;
      max-height: 852px;
      background-color: #000;
      border: 1px solid #ccc;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    header {
      background-color: #000;
      color: rgb(255, 235, 104);
      padding: 15px;
      text-align: center;
      font-size: 20px;
      font-weight: light;
    }

    /* Back to Home Page */
    #backBtn {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    background: rgba(0,0,0,0.4);
    text-decoration: none;
    font-size: 20px;
    padding: 6px 10px;
    border-radius: 8px;
    z-index: 1000;
    }

    #backBtn:active {
    transform: scale(0.6);           
    color: wrgb(151, 151, 151)
    }

    /* Chatbot image */
    #gifArea {
      width: 310px;
      height: 310px;
      margin: 0 auto;
      text-align: center;
      background: #000000;
      padding: 20px;
    }

    #gifArea img {
      width: 310px;
      height: 310px;
    }

    #chatbox {
      flex: 1;
      overflow-y: auto;
      background: #000;
      padding: 10px;
      display: flex;
      flex-direction: column;
      scroll-behavior: smooth;

      /* Hide the scroll bar, but can be scrolled */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE 10+ */
    }

    #chatbox::-webkit-scrollbar {
      display: none; /* Chrome/Safari */
    }

    .bubble {
      max-width: 80%;
      padding: 10px 14px;
      margin: 8px 0;
      border-radius: 18px;
      line-height: 1.4;
      word-wrap: break-word;
    }

    /* Typing animation */
    .typing {
      display: flex;
      align-items: center;
      gap: 4px;
      margin: 8px 0;
      padding: 10px 14px;
      background-color: #FFD700;
      border-radius: 18px;
      max-width: 80%;
      align-self: flex-start;
      text-align: left;
      border-top-left-radius: 0;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: #888;
      animation: blink 1.4s infinite both;
    }

    .dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes blink {
      0%, 80%, 100% {
        opacity: 0;
      }
      40% {
        opacity: 1;
      }
    }

    /* User & Chatbot input bubble */
    .user {
      background-color: rgb(17, 124, 69);
      color: white;
      align-self: flex-end;
      text-align: right;
      border-top-right-radius: 0;
    }

    .bot {
      border: 2px solid #FFD700; 
      color: #ffffff;
      color: white;
      align-self: flex-start;
      text-align: left;
      border-top-left-radius: 0;
    }

    #quickButtons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      padding: 10px;
      background-color: #111;
      margin-top: auto;
    }

    #quickButtons button {
      padding: 6px 10px;
      font-size: 15px;
      border-radius: 10px;
      background-color: #969071;
      color: white;
      border: none;
      cursor: pointer;
      white-space: nowrap;
    }

    #quickButtons button:active {
    transform: scale(0.96);           
    filter: brightness(0.8);        
    }

    #inputArea {
      display: flex;
      align-items: center;
      border-top: 1px solid #444;
      padding: 8px;
      background: #111;
    }

    #userInput {
      flex: 1;
      padding: 10px;
      border: 1px solid #444;
      border-radius: 20px;
      background-color: #222;
      color: white;
      outline: none;
      font-size: 14px;
    }

    .icon-btn {
      background: none;
      border: none;
      font-size: 18px;
      color: white;
      padding: 0 10px;
      cursor: pointer;
    }

    button.send-btn {
      background: #303f9f;
      color: white;
      border: none;
      border-radius: 20px;
      padding: 8px 14px;
      margin-left: 5px;
    }

    button.send-btn:active {
      transform: scale(0.95);
      filter: brightness(0.8);
    }

    @media (max-height: 880px) {
      #phone {
        transform: scale(0.9);
      }
    }

    @media (max-height: 800px) {
      #phone {
        transform: scale(0.8);
      }
    }

    @media (max-height: 720px) {
      #phone {
        transform: scale(0.7);
      }
    }
  </style>
</head>
<body>
  <!-- navigation bar -->
  <nav>
    <a href="index.html">üè† Home</a>
    <a href="chatbot.html">üí¨ Chatbot</a>
    <a href="admin.html">üõ†Ô∏è Admin</a>
  </nav>

 <!-- page content -->
  <div id="phone">
    <a href="index.html" id="backBtn">íåã</a>
    <header>‚òÄ Lighty's Here ‚òÄ</header>

    <div id="gifArea">
      <img id="chatbotGif" src="assets/happy.gif" alt="Chatbot Animation" />
    </div>

    <div id="chatbox"></div>

    <div id="quickButtons">
      <button onclick="quickAsk('I need help.')">I need help</button>
      <button onclick="quickAsk('Someone else need help.')">Someone else need help</button>
      <button onclick="quickAsk('I want to talk to someone.')">I want to talk</button>
      <button onclick="quickAsk('Can you speak another language?')">Can you speak another language?</button>
      <button onclick="quickAsk('Who are you?')">Who are you?</button>
      <button onclick="quickAsk('What can you do?')">What can you do?</button>
    </div>

    <div id="inputArea">
      <button class="icon-btn">üéôÔ∏è</button>
      <input type="text" id="userInput" placeholder="Type your message..." />
      <button class="icon-btn">‚ûï</button>
      <button class="send-btn" onclick="sendMessage()">Send</button>
    </div>

    <script>
      async function sendMessage(customMessage = null) {
      const input = document.getElementById('userInput');
      const chatbox = document.getElementById('chatbox');
      const message = customMessage || input.value.trim();

      if (!message) return;

      if (!customMessage) input.value = ""; // Clear input box (Only when message is typed)

      // User message
      const userMsg = document.createElement('div');
      userMsg.className = 'bubble user';
      userMsg.innerText = message;
      chatbox.appendChild(userMsg);
      input.value = "";

      // Add typing animation
      const typingBubble = document.createElement('div');
      typingBubble.className = 'typing';
      typingBubble.innerHTML = `
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      `;
      chatbox.appendChild(typingBubble);
      chatbox.scrollTop = chatbox.scrollHeight;

      try {
        await new Promise(r => setTimeout(r, 1000));

        const res = await fetch('http://localhost:3000/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        });

        const data = await res.json();
        const reply = data.reply;

        let text = '';
        let gif = null;

        if (typeof reply === 'object' && reply !== null) {
          text = reply.reply;
          gif = reply.gif;
        } else {
          text = reply;
        }

        const gifImg = document.querySelector('#chatbotGif');
        if (gifImg) {
          gifImg.src = gif ? `assets/${gif}` : 'assets/happy.gif';
        }

        chatbox.removeChild(typingBubble);

        const botMsg = document.createElement('div');
        botMsg.className = 'bubble bot';
        botMsg.innerText = text;
        chatbox.appendChild(botMsg);
        chatbox.scrollTop = chatbox.scrollHeight;
      } catch (err) {
        chatbox.removeChild(typingBubble);

        const errorMsg = document.createElement('div');
        errorMsg.className = 'bubble bot';
        errorMsg.innerText = '‚ö†Ô∏è Something went wrong.';
        chatbox.appendChild(errorMsg);
      }
    }

      function quickAsk(text) {
        sendMessage(text);
      }


      // Chatbox Scrolliing (with mouse)

      /* 
      This part is for demonstrating a scrollable chat box on a mobile device (scroll with mouse dragging),
      but it may not fully replicate the native mobile UX. For PC users of this demo, using the mouse wheel
      or touchpad is recommended for smoother scrolling.
      */

       const chatbox = document.getElementById('chatbox');
      let isDragging = false;
      let startY, scrollTop;

      chatbox.addEventListener('mousedown', (e) => {
        isDragging = true;
        startY = e.pageY - chatbox.offsetTop;
        scrollTop = chatbox.scrollTop;
        chatbox.style.cursor = 'grabbing';
        e.preventDefault(); //prevent rebounding
      });

      chatbox.addEventListener('mouseleave', () => {
        isDragging = false;
        chatbox.style.cursor = 'default';
      });

      chatbox.addEventListener('mouseup', () => {
        isDragging = false;
        chatbox.style.cursor = 'default';
      });

      chatbox.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
        const y = e.pageY - chatbox.offsetTop;
        const walk = (y - startY) * 3; //Make it easier to drag
        chatbox.scrollTop = scrollTop - walk;
      });
      

      // Send message with the Enter Key

      document.getElementById('userInput').addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
          event.preventDefault(); 
          sendMessage();
        }
      });

    </script>

  

    <!-- Chatbox Greeting -->

     <script>
    window.addEventListener("DOMContentLoaded", () => {
      const chatbox = document.getElementById('chatbox');

      // Typing animation
      const typingBubble = document.createElement('div');
      typingBubble.className = 'typing';
      typingBubble.innerHTML = `
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      `;
      chatbox.appendChild(typingBubble);
      chatbox.scrollTop = chatbox.scrollHeight;

      // Say hello to the user!
      setTimeout(() => {
        chatbox.removeChild(typingBubble);

        const welcomeMsg = document.createElement('div');
        welcomeMsg.className = 'bubble bot';
        welcomeMsg.innerText = "Hi there! Lighty is here :D How may I help you today?";

        chatbox.appendChild(welcomeMsg);
        chatbox.scrollTop = chatbox.scrollHeight;
      }, 600); // Delay
    });
  </script>

  </div>
</body>
</html>
